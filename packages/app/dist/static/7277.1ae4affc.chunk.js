"use strict";(()=>{(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7277],{29021:(rt,M,t)=>{t.d(M,{X:()=>ut});var c=t(25301),C=t(77125),R=t(29365),D=t(7031),p=t(58837),m=t(54917),B=t(72501),S=t(83313),Q=t(89019),b=t(62461),T=t(68887),W=t(63798),y=t(64704),d=t(6774),P=t(75625),r=t(65859),h=t(5416),K=t(33494),U=t(80113),X=t(26229),j=t(46802),ot=t(45250),s=t(14041),k=t(64947),_=t(81252),dt=t(89475),Z=t(10265);const w=(0,p.A)(a=>({root:{height:"100%",width:"315px",display:"flex",flexDirection:"column",marginRight:a.spacing(3)},value:{fontWeight:"bold",fontSize:18},header:{display:"flex",alignItems:"center",height:a.spacing(7.5),justifyContent:"space-between",borderBottom:`1px solid ${a.palette.grey[500]}`},filters:{display:"flex",flexDirection:"column","& > *":{marginTop:a.spacing(2)}}}),{name:"BackstageTableFilters"}),x=a=>{const e=w(),{onChangeFilters:o}=a,{t:i}=(0,Z.i)(dt.O),[n,l]=(0,s.useState)({...a.selectedFilters}),[u,v]=(0,s.useState)(!1),E=()=>{l({}),v(f=>!f)};return(0,s.useEffect)(()=>{o(n)},[n,o]),s.createElement(C.A,{className:e.root},s.createElement(C.A,{className:e.header},s.createElement(C.A,{className:e.value},i("table.filter.title")),s.createElement(k.A,{color:"primary",onClick:E},i("table.filter.clearAll"))),s.createElement(C.A,{className:e.filters},a.filters?.length&&a.filters.map(f=>s.createElement(_.w,{triggerReset:u,key:f.element.label,...f.element,selected:n[f.element.label],onChange:g=>l({...n,[f.element.label]:g})}))))};var tt=t(78467);function G(a){return s.createElement("tbody",{"data-testid":"loading-indicator"},s.createElement("tr",null,s.createElement("td",{colSpan:a.colSpan},s.createElement(C.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",minHeight:"15rem"}},s.createElement(tt.A,{size:"5rem"})))))}const et={Add:(0,s.forwardRef)((a,e)=>s.createElement(S.A,{...a,ref:e})),Check:(0,s.forwardRef)((a,e)=>s.createElement(b.A,{...a,ref:e})),Clear:(0,s.forwardRef)((a,e)=>s.createElement(y.A,{...a,ref:e})),Delete:(0,s.forwardRef)((a,e)=>s.createElement(d.A,{...a,ref:e})),DetailPanel:(0,s.forwardRef)((a,e)=>s.createElement(W.A,{...a,ref:e})),Edit:(0,s.forwardRef)((a,e)=>s.createElement(P.A,{...a,ref:e})),Export:(0,s.forwardRef)((a,e)=>s.createElement(X.A,{...a,ref:e})),Filter:(0,s.forwardRef)((a,e)=>s.createElement(r.A,{...a,ref:e})),FirstPage:(0,s.forwardRef)((a,e)=>s.createElement(h.A,{...a,ref:e})),LastPage:(0,s.forwardRef)((a,e)=>s.createElement(K.A,{...a,ref:e})),NextPage:(0,s.forwardRef)((a,e)=>s.createElement(W.A,{...a,ref:e})),PreviousPage:(0,s.forwardRef)((a,e)=>s.createElement(T.A,{...a,ref:e})),ResetSearch:(0,s.forwardRef)((a,e)=>s.createElement(y.A,{...a,ref:e})),Search:(0,s.forwardRef)((a,e)=>s.createElement(r.A,{...a,ref:e})),SortArrow:(0,s.forwardRef)((a,e)=>s.createElement(Q.A,{...a,ref:e})),ThirdStateCheck:(0,s.forwardRef)((a,e)=>s.createElement(U.A,{...a,ref:e})),ViewColumn:(0,s.forwardRef)((a,e)=>s.createElement(j.A,{...a,ref:e}))};function $(a,e){const o=e.split(".");let i=a[o[0]];for(let n=1;n<o.length;++n){if(i===void 0)return i;const l=o[n];i=i[l]}return i}const mt=(0,D.A)(a=>({header:{padding:a.spacing(1,2,1,2.5),borderTop:`1px solid ${a.palette.grey.A100}`,borderBottom:`1px solid ${a.palette.grey.A100}`,fontWeight:a.typography.fontWeightBold,position:"static",wordBreak:"normal",textTransform:"uppercase"}}),{name:"BackstageTableHeader"})(c.rV),N=(0,D.A)(a=>({root:{padding:a.spacing(3,0,2.5,2.5)},title:{"& > h6":{fontWeight:a.typography.fontWeightBold}},searchField:{paddingRight:a.spacing(2)}}),{name:"BackstageTableToolbar"})(c.Nb),nt=(0,p.A)(a=>({root:{display:"flex",alignItems:"center",justifyContent:"space-between"},title:{fontWeight:a.typography.fontWeightBold,fontSize:18,whiteSpace:"nowrap"}}),{name:"BackstageTableFiltersContainer"}),it=(0,p.A)(()=>({root:{display:"flex",alignItems:"start"}}),{name:"BackstageTable"});function st(a,e){return a.map(o=>{const i=o.headerStyle??{};let n=o.cellStyle||{};if(o.highlight)if(i.color=e.palette.textContrast,typeof n=="object")n.fontWeight=e.typography.fontWeightBold;else{const l=n;n=(u,v,E)=>({...l(u,v,E),fontWeight:e.typography.fontWeightBold})}return{...o,headerStyle:i,cellStyle:n}})}function ft(a,e){return(0,ot.transform)(a,(o,i,n)=>{(0,ot.isEqual)(i,e[n])||(o[n]=i)})}const Et={search:"",filtersOpen:!1,filters:{}};function ct(a){const{toolbarRef:e,setSearch:o,hasFilters:i,selectedFiltersLength:n,toggleFilters:l}=a,u=nt(),v=(0,s.useCallback)(E=>{a.onSearchChanged(E),o(E)},[a,o]);return i?s.createElement(C.A,{className:u.root},s.createElement(C.A,{className:u.root},s.createElement(R.A,{onClick:l,"aria-label":"filter list"},s.createElement(r.A,null)),s.createElement(B.A,{className:u.title},"Filters (",n,")")),s.createElement(N,{...a,ref:e,onSearchChanged:v})):s.createElement(N,{...a,ref:e,onSearchChanged:v})}function ut(a){const{data:e,columns:o,emptyContent:i,options:n,title:l,subtitle:u,localization:v,filters:E,initialState:f,onStateChange:g,components:A,isLoading:z,style:J,...L}=a,H=it(),vt=(0,m.A)(),gt={...Et,...f},[lt,pt]=(0,s.useState)(gt.filtersOpen),Ct=(0,s.useCallback)(()=>pt(ht=>!ht),[pt]),[O,I]=(0,s.useState)(gt.filters),[q,yt]=(0,s.useState)(gt.search);(0,s.useEffect)(()=>{if(g){const ht=ft({search:q,filtersOpen:lt,filters:O},Et);g(ht)}},[q,lt,O,g]);const At=(0,s.useCallback)(ht=>o.find(Dt=>Dt.title===ht)?.field,[o]),at=(0,s.useMemo)(()=>{if(typeof e=="function"||!O)return e;const ht=Object.values(O);return e&&ht.flat().length?e.filter(Bt=>!!Object.entries(O).filter(([,St])=>!!St.length).every(([St,Pt])=>{const Ft=$(Bt,At(St));return Array.isArray(Ft)&&Array.isArray(Pt)?Ft.some(Lt=>Pt.includes(Lt)):Array.isArray(Ft)?Ft.includes(Pt):Array.isArray(Pt)?Pt.includes(Ft):Ft===Pt})):e},[e,O,At]),Y=Object.values(O).flat().length,Ot=!!E?.length,Tt=(0,s.useCallback)(ht=>s.createElement(ct,{setSearch:yt,hasFilters:Ot,selectedFiltersLength:Y,toggleFilters:Ct,...ht}),[Ct,Ot,Y,yt]),Rt=typeof e!="function"&&e.length===0,Mt=o.length,It=(0,s.useMemo)(()=>F({hasNoRows:Rt,emptyContent:i,columnCount:Mt,loading:z}),[Rt,i,Mt,z]);return s.createElement(C.A,{className:H.root},lt&&e&&typeof e!="function"&&E?.length&&s.createElement(x,{filters:V(E,e,o),selectedFilters:O,onChangeFilters:I}),s.createElement(c.Ay,{components:{Header:mt,Body:It,Toolbar:Tt,...A},options:n,columns:st(o,vt),icons:et,title:s.createElement(s.Fragment,null,s.createElement(B.A,{variant:"h5",component:"h2"},l),u&&s.createElement(B.A,{color:"textSecondary",variant:"body1"},u)),data:at,style:{width:"100%",...J},localization:{toolbar:{searchPlaceholder:"Filter",searchTooltip:"Filter"},...v},...L}))}ut.icons=Object.freeze(et);function F({columnCount:a,emptyContent:e,hasNoRows:o,loading:i}){return n=>i?s.createElement(G,{colSpan:a}):e&&o?s.createElement("tbody",null,s.createElement("tr",null,s.createElement("td",{colSpan:a},e))):s.createElement(c.C6,{...n})}function V(a,e,o){const i=l=>{const u=new Set,v=E=>{E!=null&&u.add(E)};return e&&e.forEach(E=>{const f=$(E,o.find(g=>g.title===l)?.field);Array.isArray(f)?f.forEach(v):v(f)}),u},n=l=>({placeholder:"All results",label:l.column,multiple:l.type==="multiple-select",items:[...i(l.column)].sort().map(u=>({label:u,value:u}))});return a.map(l=>({type:l.type,element:n(l)}))}},77509:(rt,M,t)=>{t.d(M,{GI:()=>d});var c=t(14041),C=t(77125),R=t(64947),D=t(73845),p=t(42899),m=t(72501),B=t(5893),S=t(54917),Q=t(65859),b=t(80084),T=t(10265);const W=P=>{const r=(0,B.A)(j=>j.breakpoints.down(P.options?.drawerBreakpoint??"md")),h=(0,S.A)(),[K,U]=(0,c.useState)(!1),{t:X}=(0,T.i)(b.j);return r?c.createElement(c.Fragment,null,c.createElement(R.A,{style:{marginTop:h.spacing(1),marginLeft:h.spacing(1)},onClick:()=>U(!0),startIcon:c.createElement(Q.A,null)},X("catalogFilter.buttonTitle")),c.createElement(D.Ay,{open:K,onClose:()=>U(!1),anchor:P.options?.drawerAnchor??"left",disableAutoFocus:!0,keepMounted:!0,variant:"temporary"},c.createElement(C.A,{m:2},c.createElement(m.A,{variant:"h6",component:"h2",style:{marginBottom:h.spacing(1)}},X("catalogFilter.title")),P.children))):c.createElement(p.A,{item:!0,lg:2},P.children)},y=P=>c.createElement(p.A,{item:!0,xs:12,lg:10},P.children),d=P=>c.createElement(p.A,{container:!0,style:{position:"relative"}},P.children);d.Filters=W,d.Content=y},24999:(rt,M,t)=>{t.d(M,{y:()=>dt});var c=t(77125),C=t(72501),R=t(58837),D=t(6924),p=t(61783),m=t(14041),B=t(18139),S=t(73466),Q=t(30043),b=t(69076),T=t(86901),W=t(44148),y=t(41260);const d=m.createElement(y.A,{fontSize:"small"}),P=m.createElement(W.A,{fontSize:"small"});function r({selected:Z}){return m.createElement(b.A,{icon:d,checkedIcon:P,checked:Z})}const h=(0,m.memo)(Z=>{const{selected:w,value:x,availableOptions:tt,showCounts:G}=Z,et=G?`${x} (${tt?.[x]})`:x;return m.createElement(T.A,{control:m.createElement(r,{selected:w}),label:et,onClick:$=>$.preventDefault()})});var K=t(16249),U=t(99870),X=t.n(U);const j=(0,R.A)({input:{}},{name:"CatalogReactEntityAutocompletePickerInput"});function ot(Z){const w=j();return m.createElement(K.A,{variant:"outlined",...Z,className:X()(w.input,Z.className)})}var s=t(18453),k=t(15998);const _=(0,R.A)({root:{},label:{}},{name:"CatalogReactEntityAutocompletePicker"});function dt(Z){const{label:w,name:x,path:tt,showCounts:G,Filter:et,InputProps:$,initialSelectedOptions:mt=[],filtersForAvailableValues:N=["kind"]}=Z,nt=_(),{updateFilters:it,filters:st,queryParameters:{[x]:ft}}=(0,s.nK)(),Et=(0,B.gf)(Q.v),ct=N.map(n=>st[n]),{value:ut}=(0,S.A)(async()=>{const n=tt,{facets:l}=await Et.getEntityFacets({facets:[n],filter:(0,k.Rr)(ct.filter(Boolean))});return Object.fromEntries(l[n].map(({value:u,count:v})=>[u,v]))},[...ct]),F=(0,m.useMemo)(()=>[ft].flat().filter(Boolean),[ft]),[V,a]=(0,m.useState)(F.length?F:st[x]?.values??mt);(0,m.useEffect)(()=>{F.length&&a(F)},[F]);const e=Object.keys(ut??{}),o=V.length&&e.length;(0,m.useEffect)(()=>{it({[x]:o?new et(V):void 0})},[x,o,V,et,it]);const i=st[x];return i&&typeof i=="object"&&!("values"in i)||!e.length?null:m.createElement(c.A,{className:nt.root,pb:1,pt:1},m.createElement(C.A,{className:nt.label,variant:"button",component:"label"},w,m.createElement(p.Ay,{PopperComponent:n=>m.createElement("div",{...n},n.children),multiple:!0,disableCloseOnSelect:!0,options:e,value:V,onChange:(n,l)=>a(l),renderOption:(n,{selected:l})=>m.createElement(h,{selected:l,value:n,availableOptions:ut,showCounts:!!G}),size:"small",popupIcon:m.createElement(D.A,{"data-testid":`${String(x)}-picker-expand`}),renderInput:n=>m.createElement(ot,{...n,...$})})))}},40941:(rt,M,t)=>{t.d(M,{t:()=>i});var c=t(78560),C=t(77125),R=t(69076),D=t(86901),p=t(16249),m=t(72501),B=t(71677),S=t(58837),Q=t(7031),b=t(44148),T=t(41260),W=t(6924),y=t(61783),d=t(14041),P=t(18453),r=t(49724),h=t(16261);function K(n){const l=(0,h.J)(n);(0,d.useEffect)(()=>()=>{l.current()},[])}function U(n,l,u,v=0){const E=(0,d.useRef)(),f=(0,d.useRef)(),g=(0,d.useRef)(n),A=(0,d.useRef)(),z=()=>{E.current&&(clearTimeout(E.current),E.current=void 0),f.current&&(clearTimeout(f.current),f.current=void 0)};return K(z),(0,d.useEffect)(()=>{g.current=n},l),(0,d.useMemo)(()=>{const J=()=>{if(z(),!A.current)return;const H=A.current;A.current=void 0,g.current.apply(H.this,H.args)},L=function(...H){E.current&&clearTimeout(E.current),A.current={args:H,this:this},E.current=setTimeout(J,u),v>0&&!f.current&&(f.current=setTimeout(J,v))};return Object.defineProperties(L,{length:{value:n.length},name:{value:`${n.name||"anonymous"}__debounced__${u}`}}),L},[u,v,...l])}function X(n,l,u,v=0){(0,d.useEffect)(U(n,l,u,v),l)}var j=t(48108),ot=t(47966),s=t(53318),k=t(18139),_=t(87290),dt=t(30043),Z=t(46123),w=t.n(Z);const x=n=>typeof n=="string"?n:void 0;function tt({enabled:n}){const l=(0,k.gf)(dt.v),[u]=(0,d.useState)(async()=>{if(!n)return[];const v="relations.ownedBy",f=(await l.getEntityFacets({facets:[v]})).facets[v]?.map(g=>g.value)??[];return l.getEntitiesByRefs({entityRefs:f}).then(g=>g.items.filter(A=>A!==void 0).map(A=>A).sort((A,z)=>(A.metadata.namespace||"").localeCompare(z.metadata.namespace||"","en-US")||(x(w()(A,"spec.profile.displayName"))||A.metadata.title||A.metadata.name).localeCompare(x(w()(z,"spec.profile.displayName"))||z.metadata.title||z.metadata.name,"en-US")||A.kind.localeCompare(z.kind,"en-US"))).then(g=>g).catch(()=>[])});return(0,_.A)(async(v,E)=>{const f=await u;if(!f)return{items:[]};const g=E?.limit??20,{text:A,start:z}=G(v),J=f.filter(H=>mt(A,H)),L=z+g;return{items:J.slice(0,L),...$({entities:J,limit:L,payload:{text:A,start:L}})}},[u],{loading:!0,value:{items:[]}})}function G(n){return et(n)&&n.cursor?JSON.parse(atob(n.cursor)):{text:n.text||"",start:0}}function et(n){return!!n.cursor}function $({entities:n,limit:l,payload:u}){return n.length>l?{cursor:btoa(JSON.stringify(u))}:{}}function mt(n,l){const u=n.trim();return l.kind.includes(u)||l.metadata.namespace?.includes(u)||l.metadata.name.includes(u)||l.metadata.title?.includes(u)||w()(l,"spec.profile.displayName")?.includes(u)}function N(){const n=(0,k.gf)(dt.v);return(0,_.A)(async(l,u)=>{const v=l,E=l,f=u?.limit??20;if(E.cursor){const A=await n.queryEntities({cursor:E.cursor,limit:f});return{cursor:A.pageInfo.nextCursor,items:[...E.items,...A.items]}}const g=await n.queryEntities({fullTextFilter:{term:v.text||"",fields:["metadata.name","kind","spec.profile.displayname","metadata.title"]},filter:{kind:["User","Group"]},orderFields:[{field:"metadata.name",order:"asc"}],limit:f});return{cursor:g.pageInfo.nextCursor,items:g.items}},[],{loading:!0})}var nt=t(76842);function it({mode:n,initialSelectedOwnersRefs:l}){const u=n==="owners-only",v=N(),E=tt({enabled:u}),[f,g]=u?E:v;return[f,g,st({enabled:!u,initialSelectedOwnersRefs:l})]}function st({enabled:n,initialSelectedOwnersRefs:l}){const u=(0,d.useRef)({}),v=(0,k.gf)(dt.v),[,E]=(0,_.A)(async()=>{(await v.getEntitiesByRefs({entityRefs:l})).items.forEach(g=>{g&&(u.current[(0,c.U2)(g)]=g)})},[]);return(0,nt.u)(()=>{n&&l.length>0&&E()}),{getEntity:f=>u.current[f],setEntity:f=>{u.current[(0,c.U2)(f)]=f}}}var ft=t(46509),Et=t(96403),ct=t(80084),ut=t(10265);const F=(0,S.A)({root:{},label:{},input:{},fullWidth:{width:"100%"},boxLabel:{width:"100%",textOverflow:"ellipsis",overflow:"hidden"}},{name:"CatalogReactEntityOwnerPicker"}),V=(0,Q.A)(n=>({label:{width:"100%"},root:{width:"90%"}}),{name:"FixedWidthFormControlLabel"})(D.A),a=d.createElement(T.A,{fontSize:"small"}),e=d.createElement(b.A,{fontSize:"small"});function o(n){const l=F(),u=n.entity.kind.toLocaleLowerCase("en-US")==="group",{primaryTitle:v}=(0,ft.f)(n.entity);return d.createElement(C.A,{className:l.fullWidth},d.createElement(V,{className:l.fullWidth,control:d.createElement(R.A,{icon:a,checkedIcon:e,checked:n.isSelected}),onClick:E=>E.preventDefault(),label:d.createElement(B.Ay,{title:v},d.createElement(C.A,{display:"flex",alignItems:"center"},u?d.createElement(ot.A,{fontSize:"small"}):d.createElement(j.A,{fontSize:"small"}),"\xA0",d.createElement(C.A,{className:l.boxLabel},d.createElement(m.A,{noWrap:!0},v))))}))}const i=n=>{const l=F(),{mode:u="owners-only"}=n||{},{updateFilters:v,filters:E,queryParameters:{owners:f}}=(0,P.nK)(),[g,A]=(0,d.useState)(""),{t:z}=(0,ut.i)(ct.j),J=(0,d.useMemo)(()=>[f].flat().filter(Boolean),[f]),[L,H]=(0,d.useState)(J.length?J:E.owners?.values??[]),[{value:vt,loading:gt},lt,pt]=it({mode:u,initialSelectedOwnersRefs:L});X(()=>lt({text:g}),[g,lt],250);const Ct=vt?.items||[];return(0,d.useEffect)(()=>{if(J.length){const O=new r.N9(J);H(O.values)}},[J]),(0,d.useEffect)(()=>{v({owners:L.length?new r.N9(L):void 0})},[L,v]),["user","group"].includes(E.kind?.value.toLocaleLowerCase("en-US")||"")?null:d.createElement(C.A,{className:l.root,pb:1,pt:1},d.createElement(m.A,{className:l.label,variant:"button",component:"label"},z("entityOwnerPicker.title"),d.createElement(y.Ay,{PopperComponent:O=>d.createElement("div",{...O},O.children),multiple:!0,disableCloseOnSelect:!0,loading:gt,options:Ct,value:L,getOptionSelected:(O,I)=>typeof I=="string"?(0,c.U2)(O)===I:O===I,getOptionLabel:O=>{const I=typeof O=="string"?pt.getEntity(O)||(0,c.KU)(O,{defaultKind:"group",defaultNamespace:"default"}):O;return(0,s.Z)(I,(0,s.S)(I))},onChange:(O,I)=>{A(""),H(I.map(q=>{const yt=typeof q=="string"?q:(0,c.U2)(q);return typeof q!="string"&&pt.setEntity(q),yt}))},filterOptions:O=>O,renderOption:(O,{selected:I})=>d.createElement(o,{entity:O,isSelected:I}),size:"small",popupIcon:d.createElement(W.A,{"data-testid":"owner-picker-expand"}),renderInput:O=>d.createElement(p.A,{...O,className:l.input,onChange:I=>{A(I.currentTarget.value)},variant:"outlined"}),ListboxProps:{onScroll:O=>{const I=O.currentTarget;Math.abs(I.scrollHeight-I.clientHeight-I.scrollTop)<1&&vt?.cursor&&lt({items:vt.items,cursor:vt.cursor})},"data-testid":"owner-picker-listbox"}})))}},56829:(rt,M,t)=>{t.d(M,{m:()=>S});var c=t(58837),C=t(14041),R=t(49724),D=t(24999),p=t(80084),m=t(10265);const B=(0,c.A)({input:{}},{name:"CatalogReactEntityTagPicker"}),S=Q=>{const b=B(),{t:T}=(0,m.i)(p.j);return C.createElement(D.y,{label:T("entityTagPicker.title"),name:"tags",path:"metadata.tags",Filter:R.q_,showCounts:Q.showCounts,InputProps:{className:b.input}})}},30117:(rt,M,t)=>{t.d(M,{y:()=>a});var c=t(18139),C=t(54195),R=t(40703),D=t(58007),p=t(46423),m=t(65569),B=t(5951),S=t(26343),Q=t(72501),b=t(58837),T=t(9684),W=t(92483),y=t(14041),d=t(49724),P=t(18453),r=t(46343),h=t(40074),K=t(46123),U=t(96403),X=t(94223),j=t(45250),ot=t(73466),s=t(30043),k=t(15998),_=t(87290),dt=function(e){return e!==Object(e)},Z=function(e,o,i){var n=(0,y.useRef)(void 0);(!n.current||!i(o,n.current))&&(n.current=o),(0,y.useEffect)(e,n.current)};const w=Z;var x=t(56307),tt=t.n(x);const G=tt();var et=function(e){return e!==Object(e)},$=function(e,o){w(e,o,G)};const mt=$;function N(){const e=(0,c.gf)(X.K),o=(0,c.gf)(s.v),{filters:i}=(0,P.nK)(),{value:n,loading:l}=(0,ot.A)(async()=>(await e.getBackstageIdentity()).ownershipEntityRefs,[]),{user:u,owners:v,...E}=i,f=(0,k.$3)((0,j.compact)(Object.values(E))),[{value:g,loading:A},z]=(0,_.A)(async L=>{const H=nt(L.owners,L.ownershipEntityRefs);if(H===void 0)return 0;const{["metadata.name"]:vt,...gt}=L.filter.filter,{totalItems:lt}=await o.queryEntities({...L.filter,filter:{...gt,"relations.ownedBy":H},limit:0});return lt},[],{loading:!0});return mt(()=>{Object.keys(f.filter).length!==0&&n!==void 0&&z({ownershipEntityRefs:n,owners:v,filter:f})},[n,v,f]),{count:g,loading:l||A,filter:(0,y.useMemo)(()=>d.tN.owned(n??[]),[n]),ownershipEntityRefs:n}}function nt(e,o){if(o===void 0)return;const i=e?.values??[];if(i.length){const n=(0,j.intersection)(i,o);return n.length===0?void 0:n}return o}function it(){const e=(0,c.gf)(s.v),{filters:o}=(0,P.nK)(),i=(0,y.useRef)(),n=(0,y.useMemo)(()=>{const{user:v,...E}=o,f=(0,j.compact)(Object.values(E)),g=(0,k.$3)(f),A={...g,limit:0};return Object.keys(g.filter).length===0?(i.current=void 0,i.current):(0,j.isEqual)(A,i.current)?i.current:(i.current=A,A)},[o]),{value:l,loading:u}=(0,ot.A)(async()=>{if(n===void 0)return 0;const{totalItems:v}=await e.queryEntities(n);return v},[n]);return{count:l,loading:u}}var st=t(78560),ft=t(44861);function Et(){const e=(0,c.gf)(s.v),{filters:o}=(0,P.nK)(),{starredEntities:i}=(0,ft.I)(),n=(0,y.useRef)(),l=(0,y.useMemo)(()=>{const{user:f,...g}=o,A=(0,j.compact)(Object.values(g)),z=(0,k.$3)(A),L={...z,filter:{...z.filter,["metadata.name"]:Array.from(i).map(H=>(0,st.KU)(H).name)},limit:1e3};return(0,j.isEqual)(L,n.current)?n.current:(n.current=L,L)},[o,i]),{value:u,loading:v}=(0,ot.A)(async()=>i.size?(await e.queryEntities(l)).items.map(g=>(0,st.U2)({kind:g.kind,namespace:g.metadata.namespace,name:g.metadata.name})).filter(g=>i.has(g)).length:0,[l,i]),E=(0,y.useMemo)(()=>d.tN.starred(Array.from(i)),[i]);return{count:u,loading:v,filter:E}}var ct=t(10265),ut=t(80084);const F=(0,b.A)(e=>({root:{backgroundColor:"rgba(0, 0, 0, .11)",boxShadow:"none",margin:e.spacing(1,0,1,0)},title:{margin:e.spacing(1,0,0,1),textTransform:"uppercase",fontSize:12,fontWeight:"bold"},listIcon:{minWidth:30,color:e.palette.text.primary},menuItem:{minHeight:e.spacing(6)},groupWrapper:{margin:e.spacing(1,1,2,1)}}),{name:"CatalogReactUserListPicker"});function V(e,o){return[{name:o("userListPicker.personalFilter.title"),items:[{id:"owned",label:o("userListPicker.personalFilter.ownedLabel"),icon:T.A},{id:"starred",label:o("userListPicker.personalFilter.starredLabel"),icon:W.Gg}]},{name:e,items:[{id:"all",label:o("userListPicker.orgFilterAllLabel")}]}]}const a=e=>{const{initialFilter:o,availableFilters:i}=e,n=F(),l=(0,c.gf)(C.U),{t:u}=(0,ct.i)(ut.j),v=l.getOptionalString("organization.name")??u("userListPicker.defaultOrgName"),{filters:E,updateFilters:f,queryParameters:{kind:g,user:A}}=(0,P.nK)(),z=["starred","all"],J=V(v,u).map(at=>({...at,items:at.items.filter(({id:Y})=>["group","user"].some(Ot=>Ot===g)?z.includes(Y):!i||i.includes(Y))})).filter(({items:at})=>!!at.length),{count:L,loading:H,filter:vt}=N(),{count:gt}=it(),{count:lt,filter:pt,loading:Ct}=Et(),O=(0,y.useMemo)(()=>[A].flat()[0],[A]),[I,q]=(0,y.useState)(O??o),yt=(0,y.useMemo)(()=>({all:gt,starred:lt,owned:L}),[lt,L,gt]);(0,y.useEffect)(()=>{O&&q(O)},[O]);const At=H||Ct;return(0,y.useEffect)(()=>{!At&&I&&I!=="all"&&yt[I]===0&&q("all")},[At,yt,I,q]),(0,y.useEffect)(()=>{if(!I||At)return;f({user:I==="owned"?vt:I==="starred"?pt:d.tN.all()})},[I,pt,vt,f,At]),y.createElement(R.A,{className:n.root},J.map(at=>y.createElement(y.Fragment,{key:at.name},y.createElement(Q.A,{variant:"subtitle2",component:"span",className:n.title},at.name),y.createElement(R.A,{className:n.groupWrapper},y.createElement(D.A,{disablePadding:!0,dense:!0,role:"menu","aria-label":at.name},at.items.map((Y,Ot)=>y.createElement(S.A,{role:"none presentation",key:Y.id,divider:Ot!==at.items.length-1,onClick:()=>q(Y.id),selected:Y.id===E.user?.value,className:n.menuItem,disabled:yt[Y.id]===0,"data-testid":`user-picker-${Y.id}`,tabIndex:0,ContainerProps:{role:"menuitem"}},Y.icon&&y.createElement(p.A,{className:n.listIcon},y.createElement(Y.icon,{fontSize:"small"})),y.createElement(B.A,null,y.createElement(Q.A,{variant:"body1"},Y.label," ")),y.createElement(m.A,null,yt[Y.id]??"-"))))))))}},49724:(rt,M,t)=>{t.d(M,{I5:()=>Q,Kf:()=>y,N9:()=>S,V3:()=>B,gM:()=>D,gZ:()=>W,mT:()=>d,qA:()=>p,q_:()=>m,tN:()=>T,z:()=>b});var c=t(78560),C=t(97214),R=t(699);class D{constructor(r){this.value=r}getCatalogFilters(){return{kind:this.value}}toQueryValue(){return this.value}}class p{constructor(r){this.value=r}getTypes(){return Array.isArray(this.value)?this.value:[this.value]}getCatalogFilters(){return{"spec.type":this.getTypes()}}toQueryValue(){return this.getTypes()}}class m{constructor(r){this.values=r}filterEntity(r){return this.values.every(h=>(r.metadata.tags??[]).includes(h))}getCatalogFilters(){return{"metadata.tags":this.values}}toQueryValue(){return this.values}}class B{constructor(r){this.value=r}filterEntity(r){const h=this.toUpperArray(this.value.split(/\s/)),K=this.toUpperArray([r.metadata.tags]),U=this.toUpperArray([r.metadata.name,r.metadata.title]);for(const X of h)if(K.every(j=>j!==X)&&U.every(j=>!j.includes(X)))return!1;return!0}getFullTextFilters(){return{term:this.value,fields:["metadata.name","metadata.title","spec.profile.displayName"]}}toQueryValue(){return this.value}toUpperArray(r){return r.flat().filter(h=>!!h).map(h=>h.toLocaleUpperCase("en-US"))}}class S{values;constructor(r){this.values=r.reduce((h,K)=>{try{return h.push((0,c.U2)((0,c.KU)(K,{defaultKind:"Group"}))),h}catch{return h}},[])}getCatalogFilters(){return{"relations.ownedBy":this.values}}filterEntity(r){return this.values.some(h=>(0,R.t)(r,C.vv).some(K=>(0,c.U2)(K)===h))}toQueryValue(){return this.values}}class Q{constructor(r){this.values=r}getCatalogFilters(){return{"spec.lifecycle":this.values}}filterEntity(r){return this.values.some(h=>r.spec?.lifecycle===h)}toQueryValue(){return this.values}}class b{constructor(r){this.values=r}getCatalogFilters(){return{"metadata.namespace":this.values}}filterEntity(r){return this.values.some(h=>r.metadata.namespace===h)}toQueryValue(){return this.values}}class T{constructor(r,h){this.value=r,this.refs=h}static owned(r){return new T("owned",r)}static all(){return new T("all")}static starred(r){return new T("starred",r)}getCatalogFilters(){return this.value==="owned"?{"relations.ownedBy":this.refs??[]}:this.value==="starred"?{"metadata.name":this.refs?.map(r=>(0,c.KU)(r).name)??[]}:{}}filterEntity(r){if(this.value==="starred")return this.refs?.includes((0,c.U2)(r))??!0;if(this.value==="owned"){const h=(0,R.t)(r,C.vv);return this.refs?.some(K=>h.some(U=>(0,c.U2)(U)===K))??!1}return!0}toQueryValue(){return this.value}}class W{constructor(r,h,K){this.value=r,this.isOwnedEntity=h,this.isStarredEntity=K}filterEntity(r){switch(this.value){case"owned":return this.isOwnedEntity(r);case"starred":return this.isStarredEntity(r);default:return!0}}toQueryValue(){return this.value}}class y{constructor(r){this.value=r}getCatalogFilters(){return this.value?{"metadata.annotations.backstage.io/orphan":String(this.value)}:{}}filterEntity(r){const h=r.metadata.annotations?.["backstage.io/orphan"];return h!==void 0&&this.value.toString()===h}}class d{constructor(r){this.value=r}filterEntity(r){const h=r?.status?.items?.length>0;return h!==void 0&&this.value===h}}},18453:(rt,M,t)=>{t.d(M,{B9:()=>d,nK:()=>P});var c=t(45250),C=t.n(c),R=t(45810),D=t.n(R),p=t(14041),m=t(18690),B=t(87290),S=t(22771),Q=t(71581),b=t(30043),T=t(15998),W=t(18139);const y=(0,p.createContext)(void 0),d=r=>{const h=(0,Q.A)(),K=(0,W.gf)(b.v),[U,X]=(0,p.useState)({}),j=(0,m.zy)(),s=r.pagination===!0?"cursor":typeof r.pagination=="object"?r.pagination.mode??"cursor":"none",k=typeof r.pagination=="object"?r.pagination.limit??20:20,{queryParameters:_,cursor:dt,offset:Z,limit:w}=(0,p.useMemo)(()=>{const F=D().parse(j.search,{ignoreQueryPrefix:!0});let V=k;if(typeof F.limit=="string"){const e=Number.parseInt(F.limit,10);isNaN(e)||(V=e)}const a=typeof F.offset=="string"&&s==="offset"?Number.parseInt(F.offset,10):void 0;return{queryParameters:F.filters??{},cursor:typeof F.cursor=="string"&&s==="cursor"?F.cursor:void 0,offset:s==="offset"&&a&&!isNaN(a)?a:void 0,limit:V}},[s,j.search,k]),[x,tt]=(0,p.useState)(dt),[G,et]=(0,p.useState)(Z),[$,mt]=(0,p.useState)(w),[N,nt]=(0,p.useState)(()=>({appliedFilters:{},entities:[],backendEntities:[],pageInfo:s==="cursor"?{}:void 0,offset:G,limit:$})),[{loading:it,error:st},ft]=(0,B.A)(async()=>{const F=(0,c.compact)(Object.values(U)),V=Object.keys(U).reduce((a,e)=>{const o=U[e];return o?.toQueryValue&&(a[e]=o.toQueryValue()),a},{});if(s!=="none")if(x){if(x!==N.appliedCursor){const a=(0,T.be)(F),e=await K.queryEntities({cursor:x,limit:$});nt({appliedFilters:U,appliedCursor:x,backendEntities:e.items,entities:e.items.filter(a),pageInfo:e.pageInfo,totalItems:e.totalItems})}}else{const a=(0,T.be)(F),e=(0,T.$3)(F),o=(0,T.$3)((0,c.compact)(Object.values(N.appliedFilters)));if(s==="offset"||!(0,c.isEqual)(o,e)){const i=await K.queryEntities({...e,limit:$,offset:G,orderFields:[{field:"metadata.name",order:"asc"}]});nt({appliedFilters:U,backendEntities:i.items,entities:i.items.filter(a),pageInfo:i.pageInfo,totalItems:i.totalItems,limit:$,offset:G})}}else{const a=(0,T.be)(F),e=(0,T.Rr)(F),o=(0,T.Rr)((0,c.compact)(Object.values(N.appliedFilters)));if((0,c.isEqual)(o,e)){const i=N.backendEntities.filter(a);nt({appliedFilters:U,backendEntities:N.backendEntities,entities:i,totalItems:i.length})}else{const i=await K.getEntities({filter:e}),n=i.items.filter(a);nt({appliedFilters:U,backendEntities:i.items,entities:n,totalItems:n.length})}}if(h()){const a=D().parse(j.search,{ignoreQueryPrefix:!0}),e=D().stringify({...a,filters:V,cursor:x,offset:G,limit:$},{addQueryPrefix:!0,arrayFormat:"repeat"}),o=`${window.location.pathname}${e}`;window.history?.replaceState(null,document.title,o)}},[K,_,U,N,x,s,$,G],{loading:!0});(0,S.A)(ft,10,[U,x,$,G]);const Et=(0,p.useCallback)(F=>{tt(void 0),X(V=>{const a=typeof F=="function"?F(V):F;return{...V,...a}})},[]),ct=(0,p.useMemo)(()=>{if(s!=="cursor")return;const F=N.pageInfo?.prevCursor,V=N.pageInfo?.nextCursor;return{prev:F?()=>tt(F):void 0,next:V?()=>tt(V):void 0}},[s,N.pageInfo]),ut=(0,p.useMemo)(()=>({filters:N.appliedFilters,entities:N.entities,backendEntities:N.backendEntities,updateFilters:Et,queryParameters:_,loading:it,error:st,pageInfo:ct,totalItems:N.totalItems,limit:$,offset:G,setLimit:mt,setOffset:et,paginationMode:s}),[N,Et,_,it,st,ct,$,G,s,mt,et]);return p.createElement(y.Provider,{value:ut},r.children)};function P(){const r=(0,p.useContext)(y);if(!r)throw new Error("useEntityList must be used within EntityListProvider");return r}},44861:(rt,M,t)=>{t.d(M,{I:()=>T});var c=t(78560),C=t(18139),R=t(14041),D=t(11746),p=t(46123),m=t.n(p),B=t(9974),S=t(96403),Q=t.n(S);function b(W){return typeof W=="string"?W:(0,c.U2)(W)}function T(){const W=(0,C.gf)(B.a),y=(0,D.A)((0,R.useMemo)(()=>W.starredEntitie$(),[W]),new Set),d=(0,R.useCallback)(r=>y.has(b(r)),[y]),P=(0,R.useCallback)(r=>W.toggleStarred(b(r)).then(),[W]);return{starredEntities:y,toggleStarredEntity:P,isStarredEntity:d}}},15998:(rt,M,t)=>{t.d(M,{$3:()=>R,Rr:()=>D,be:()=>p});var c=t(49724);function C(m){return!!m.getFullTextFilters}function R(m){const B=m.reduce((Q,b)=>({...Q,...b.getCatalogFilters?b.getCatalogFilters():{}}),{}),S=m.find(C)?.getFullTextFilters();return{filter:B,fullTextFilter:S}}function D(m){const B={};return m.forEach(S=>{S instanceof c.q_||S instanceof c.N9||S instanceof c.I5||S instanceof c.z||S instanceof c.tN||S instanceof c.Kf||S instanceof c.V3||S instanceof c.gZ||Object.assign(B,S.getCatalogFilters?.()||{})}),B}function p(m){return B=>m.every(S=>!S.filterEntity||S.filterEntity(B))}},44148:(rt,M,t)=>{var c,C=t(4293),R=t(78920);c={value:!0},M.A=void 0;var D=R(t(14041)),p=C(t(74044)),m=(0,p.default)(D.createElement("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox");M.A=m},41260:(rt,M,t)=>{var c,C=t(4293),R=t(78920);c={value:!0},M.A=void 0;var D=R(t(14041)),p=C(t(74044)),m=(0,p.default)(D.createElement("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank");M.A=m},47966:(rt,M,t)=>{var c,C=t(4293),R=t(78920);c={value:!0},M.A=void 0;var D=R(t(14041)),p=C(t(74044)),m=(0,p.default)(D.createElement("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"}),"Group");M.A=m}}]);})();

//# sourceMappingURL=7277.1ae4affc.chunk.js.map